<!DOCTYPE html>

<html lang="en">
	<head>
		<title>Lamp Store</title>
		<!--
		Attribution
		Mozilla's boilerplate: https://github.com/MozVR/vr-web-examples/tree/master/threejs-vr-boilerplate
		Andrea: https://github.com/hawksley
		Music: 
		-->
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
		<style>
			body {
				background-color: #000;
				color: #fff;
				margin: 0px;
				padding: 0;
				overflow: hidden;
			}
		</style>
	</head>

	<body>
		
	</body>

	
	<script src="../js/three.min.js"></script>
	<script src="../js/VRControlsPlus.js"></script>
	<script src="../js/VREffect.js"></script>
	<script src="../lib/gl-matrix.js"></script>
	<script src="../js/VRCursor.js"></script>
	<script src="../loaders/OBJloader.js"></script>
	<script src="../physics/physi.js"></script>

	<script>

	 // Physijs.scripts.worker = '/physics/physijs_worker.js';
  //   Physijs.scripts.ammo = '/physics/ammo.js';
		/*
		Setup three.js WebGL renderer
		*/
		var renderer = new THREE.WebGLRenderer( { antialias: true } );
		/*
		Append the canvas element created by the renderer to document body element.
		*/
		document.body.appendChild( renderer.domElement );
		/*
		Create a three.js scene
		*/
		var scene = new THREE.Scene();
		/*
		Create a three.js camera
		*/
		var camera = new THREE.PerspectiveCamera( 75, window.innerWidth / window.innerHeight, 1, 10000 );

		/*
		Apply VR headset positional data to camera.
		*/
		var controls = new THREE.VRControls( camera );

		/*
		Apply VR stereo rendering to renderer
		*/
		var effect = new THREE.VREffect( renderer );
		effect.setSize( window.innerWidth, window.innerHeight );

		/*
		Light
		*/
		var light = new THREE.AmbientLight( 0xffffff );
		light.castShadow = true;
		light.intensity = 10;
		scene.add( light );

		var light1 = new THREE.PointLight( 0x78FFC2, .5, 0 );
		light1.castShadow = true;

		var light2 = new THREE.PointLight( 0xFF5050, 1, 0 );
		light2.castShadow = true;
		scene.add (light2);

		/*
		Floor
		*/
		var floorImage = new THREE.ImageUtils.loadTexture( "images/stone.jpg" );
		floorImage.wrapS = floorImage.wrapT = THREE.RepeatWrapping; 
		floorImage.repeat.set( 10, 10 );
		var floorGeometry = new THREE.PlaneBufferGeometry( 100, 100, 10 );
		var floorMaterial = new THREE.MeshBasicMaterial( {map: floorImage, color: 0x0475a1, side: THREE.DoubleSide} );
		var floor = new THREE.Mesh( floorGeometry, floorMaterial );
		floor.rotation.x = 90 * Math.PI/180;
		floor.position.y = -5;
		scene.add( floor );

		/*
		Lamp Model
		*/
		var lamp1;	
        var loader = new THREE.OBJLoader();
		loader.load( "objs/Lampshade1.obj", function ( obj ) {
			obj.children[0].material = new THREE.MeshPhongMaterial( { ambient: 0x030303, color: 0xdddddd, specular: 0x009900, shininess: 30, shading: THREE.SmoothShading } );
			obj.children[0].geometry.computeFaceNormals();
			obj.children[0].geometry.computeVertexNormals();
			obj.children[0].flipSided = true;
			obj.children[0].doubleSided = true;
			obj.castShadow = true;
			obj.scale.set(.05,.05,.05); 
			obj.rotation.set((-90 * Math.PI/180),0,0);
			obj.position.set(0,10,-10);
			lamp1 = obj;
			lamp1.add( light1 );
			scene.add( lamp1 );
		});
		

		var loader = new THREE.OBJLoader();
		loader.load( "objs/creature3.obj", function ( obj ) {
			obj.children[0].material = new THREE.MeshPhongMaterial( { ambient: 0x030303, color: 0xdddddd, specular: 0x009900, shininess: 30, shading: THREE.SmoothShading } );
			obj.children[0].geometry.computeFaceNormals();
			obj.children[0].geometry.computeVertexNormals();
			obj.children[0].flipSided = true;
			obj.children[0].doubleSided = true;
			obj.castShadow = true;
			obj.scale.set(1,1,1); 
			obj.rotation.set((-90 * Math.PI/180),0,0);
			obj.position.set(0,10,-10);
			lamp1 = obj;
			lamp1.add( light1 );
			scene.add( lamp1 );
		});


		var lamp2;
		loader.load( "objs/Lampshade2.obj", function ( obj ) {
			obj.children[0].material.map = THREE.ImageUtils.loadTexture('images/glitter.jpg');
			obj.children[0].geometry.computeFaceNormals();
			obj.children[0].geometry.computeVertexNormals();
			obj.children[0].flipSided = true;
			obj.children[0].doubleSided = true;
			obj.castShadow = true;
			obj.scale.set(.05,.05,.05); 
			obj.rotation.set((-90 * Math.PI/180),0,0);
			obj.position.set(0,10,0);
			lamp2 = obj;
			lamp2.add( light2 );
			scene.add( lamp2 );
		});

		

		var selectable = [];
		
		/*
		create cursor
		*/
		var cursor = new VRCursor();
		cursor.ready.then(function() {
	    	scene.add(cursor.layout);
	    	cursor.init(renderer.domElement, camera, scene, selectable);
	    	cursor.enable();
	    });

		/*
		Request animation frame loop function
		*/
		var prevSelected = null;
		function animate() {
			if (cursor.enabled) {
        		cursor.updatePosition();

        		if ( cursor.objectMouseOver !== null && prevSelected !== cursor.objectMouseOver) {
        			cursor.objectMouseOver.material.color.set(0x009933);
        		} 

        		if (prevSelected !== null && prevSelected !== cursor.objectMouseOver) {
        			prevSelected.material.color.set(0xffffff);
        		}

        		prevSelected = cursor.objectMouseOver;
        	}

			/*
			Update VR headset position and apply to camera.
			*/
			controls.update();

			if (camera.position.y != 0){
				camera.position.y = 0;
			}

			/*
			Render the scene through the VREffect.
			*/
			// scene.simulate();
			effect.render( scene, camera );
			requestAnimationFrame( animate );

		}

		/*
		Kick off animation loop
		*/
		animate();
		
		/*
		Links
		*/
		
		function link(){
			if(cursor.objectMouseOver == exitSign){
				window.location="http://hyperlinkspace.com";
				}
			}
		
	
		
		/*
		Listen for double click event to enter full-screen VR mode
		*/
		document.body.addEventListener( 'dblclick', function() {
			effect.setFullScreen( true );
		});

		/*
		Listen for keyboard event and zero positional sensor on appropriate keypress.
		*/
		function onkey(event) {
	    event.preventDefault();
             if (event.keyCode == 90) { // z
	    	controls.zeroSensor(); //zero rotation
	    } else if (event.keyCode == 70 || event.keyCode == 13) { //f or enter
	    	effect.setFullScreen(true) //fullscreen
	    } else if (event.keyCode == 32  ) {//space
	  		link();
	  	}
	  };

	  window.addEventListener("keydown", onkey, true);


		/*
		Handle window resizes
		*/
		function onWindowResize() {
			camera.aspect = window.innerWidth / window.innerHeight;
			camera.updateProjectionMatrix();

			effect.setSize( window.innerWidth, window.innerHeight );
		}

		window.addEventListener( 'resize', onWindowResize, false );

	</script>
</html>